<!DOCTYPE html>
<html lang="en">
<head>
    <title>three.js webgl - interactive cubes</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <style>
        body {
            font-family: Monospace, serif;
            background-color: #f0f0f0;
            margin: 0;
            overflow: hidden;
        }
    </style>
    <script type="text/javascript" src="three.js"></script>
    <script type="text/javascript" src="SubdivisionModifier.js"></script>
    <script type="text/javascript" src="d3.v3.min.js"></script>
    <script type="text/javascript" src="underscore-min.js"></script>
    <script type="text/javascript" src="util.js"></script>
</head>
<body>


<script style="display:none">
    <!--
    // stats.js - http://github.com/mrdoob/stats.js
    var Stats = function () {
        var l = Date.now(), m = l, g = 0, n = Infinity, o = 0, h = 0, p = Infinity, q = 0, r = 0, s = 0, f = document.createElement("div");
        f.id = "stats";
        f.addEventListener("mousedown", function (b) {
            b.preventDefault();
            t(++s % 2)
        }, !1);
        f.style.cssText = "xSize:80px;opacity:0.9;cursor:pointer";
        var a = document.createElement("div");
        a.id = "fps";
        a.style.cssText = "padding:0 0 3px 3px;text-align:left;background-color:#002";
        f.appendChild(a);
        var i = document.createElement("div");
        i.id = "fpsText";
        i.style.cssText = "color:#0ff;font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px";
        i.innerHTML = "FPS";
        a.appendChild(i);
        var c = document.createElement("div");
        c.id = "fpsGraph";
        c.style.cssText = "position:relative;xSize:74px;height:30px;background-color:#0ff";
        for (a.appendChild(c); 74 > c.children.length;) {
            var j = document.createElement("span");
            j.style.cssText = "xSize:1px;height:30px;float:left;background-color:#113";
            c.appendChild(j)
        }
        var d = document.createElement("div");
        d.id = "ms";
        d.style.cssText = "padding:0 0 3px 3px;text-align:left;background-color:#020;display:none";
        f.appendChild(d);
        var k = document.createElement("div");
        k.id = "msText";
        k.style.cssText = "color:#0f0;font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px";
        k.innerHTML = "MS";
        d.appendChild(k);
        var e = document.createElement("div");
        e.id = "msGraph";
        e.style.cssText = "position:relative;xSize:74px;height:30px;background-color:#0f0";
        for (d.appendChild(e); 74 > e.children.length;)j = document.createElement("span"), j.style.cssText = "xSize:1px;height:30px;float:left;background-color:#131", e.appendChild(j);
        var t = function (b) {
            s = b;
            switch (s) {
                case 0:
                    a.style.display =
                            "block";
                    d.style.display = "none";
                    break;
                case 1:
                    a.style.display = "none", d.style.display = "block"
            }
        };
        return {
            REVISION: 11, domElement: f, setMode: t, begin: function () {
                l = Date.now()
            }, end: function () {
                var b = Date.now();
                g = b - l;
                n = Math.min(n, g);
                o = Math.max(o, g);
                k.textContent = g + " MS (" + n + "-" + o + ")";
                var a = Math.min(30, 30 - 30 * (g / 200));
                e.appendChild(e.firstChild).style.height = a + "px";
                r++;
                b > m + 1E3 && (h = Math.round(1E3 * r / (b - m)), p = Math.min(p, h), q = Math.max(q, h), i.textContent = h + " FPS (" + p + "-" + q + ")", a = Math.min(30, 30 - 30 * (h / 100)), c.appendChild(c.firstChild).style.height =
                        a + "px", m = b, r = 0);
                return b
            }, update: function () {
                l = this.end()
            }
        }
    };

    //-->
</script>

<script>
    var container = document.createElement('div');
    document.body.appendChild(container);

    var rootNode = {"name": "", "fileChanges": "671","committers": "32", "children": [
                {"name": "src", "fileChanges": "586","committers": "30", "children": [
                    {"name": "main", "fileChanges": "365","committers": "28", "children": [
                        {"name": "java", "fileChanges": "357","committers": "28", "children": [
                            {"name": "org", "fileChanges": "350","committers": "28", "children": [
                                {"name": "junit", "fileChanges": "350","committers": "28", "children": [
                                    {"name": "runners", "fileChanges": "82","committers": "13", "children": [
                                        {"name": "model", "fileChanges": "37","committers": "9", "children": [
                                            {"name": "FrameworkField.java", "fileChanges": "4","committers": "2", "children": []},
                                            {"name": "FrameworkMember.java", "fileChanges": "2","committers": "2", "children": []},
                                            {"name": "FrameworkMethod.java", "fileChanges": "10","committers": "4", "children": []},
                                            {"name": "TestTimedOutException.java", "fileChanges": "3","committers": "1", "children": []},
                                            {"name": "TestClass.java", "fileChanges": "16","committers": "3", "children": []},
                                            {"name": "MultipleFailureException.java", "fileChanges": "2","committers": "1", "children": []}]},
                                        {"name": "ParentRunner.java", "fileChanges": "30","committers": "5", "children": []},
                                        {"name": "BlockJUnit4ClassRunner.java", "fileChanges": "7","committers": "4", "children": []},
                                        {"name": "Parameterized.java", "fileChanges": "6","committers": "3", "children": []},
                                        {"name": "Suite.java", "fileChanges": "2","committers": "1", "children": []}]},
                                    {"name": "internal", "fileChanges": "42","committers": "9", "children": [
                                        {"name": "runners", "fileChanges": "32","committers": "9", "children": [
                                            {"name": "statements", "fileChanges": "14","committers": "3", "children": [
                                                {"name": "FailOnTimeout.java", "fileChanges": "12","committers": "3", "children": []},
                                                {"name": "TestFailedOnTimeoutException.java", "fileChanges": "2","committers": "1", "children": []}]},
                                            {"name": "MethodRoadie.java", "fileChanges": "2","committers": "1", "children": []},
                                            {"name": "rules", "fileChanges": "2","committers": "2", "children": [
                                                {"name": "RuleFieldValidator.java", "fileChanges": "2","committers": "2", "children": []}]},
                                            {"name": "ExceptionWithThread.java", "fileChanges": "2","committers": "1", "children": []},
                                            {"name": "JUnit38ClassRunner.java", "fileChanges": "7","committers": "3", "children": []},
                                            {"name": "ErrorReportingRunner.java", "fileChanges": "5","committers": "1", "children": []}]},
                                        {"name": "Throwables.java", "fileChanges": "2","committers": "1", "children": []},
                                        {"name": "builders", "fileChanges": "2","committers": "1", "children": [
                                            {"name": "AnnotatedBuilder.java", "fileChanges": "2","committers": "1", "children": []}]},
                                        {"name": "requests", "fileChanges": "3","committers": "1", "children": [
                                            {"name": "ClassRequest.java", "fileChanges": "3","committers": "1", "children": []}]},
                                        {"name": "Classes.java", "fileChanges": "3","committers": "1", "children": []}]},
                                    {"name": "Assert.java", "fileChanges": "6","committers": "4", "children": []},
                                    {"name": "Rule.java", "fileChanges": "2","committers": "2", "children": []},
                                    {"name": "experimental", "fileChanges": "109","committers": "10", "children": [
                                        {"name": "theories", "fileChanges": "63","committers": "5", "children": [
                                            {"name": "internal", "fileChanges": "23","committers": "2", "children": [
                                                {"name": "ParameterizedAssertionError.java", "fileChanges": "1","committers": "1", "children": []},
                                                {"name": "AllMembersSupplier.java", "fileChanges": "12","committers": "2", "children": []},
                                                {"name": "Assignments.java", "fileChanges": "6","committers": "1", "children": []},
                                                {"name": "BooleanSupplier.java", "fileChanges": "1","committers": "1", "children": []},
                                                {"name": "EnumSupplier.java", "fileChanges": "1","committers": "1", "children": []},
                                                {"name": "SpecificDataPointsSupplier.java", "fileChanges": "2","committers": "1", "children": []}]},
                                            {"name": "Theories.java", "fileChanges": "5","committers": "3", "children": []},
                                            {"name": "ParametersSuppliedBy.java", "fileChanges": "2","committers": "1", "children": []},
                                            {"name": "suppliers", "fileChanges": "2","committers": "1", "children": [
                                                {"name": "TestedOn.java", "fileChanges": "2","committers": "1", "children": []}]},
                                            {"name": "DataPoints.java", "fileChanges": "7","committers": "2", "children": []},
                                            {"name": "DataPoint.java", "fileChanges": "5","committers": "1", "children": []},
                                            {"name": "ParameterSignature.java", "fileChanges": "5","committers": "1", "children": []},
                                            {"name": "PotentialAssignment.java", "fileChanges": "7","committers": "1", "children": []},
                                            {"name": "ParameterSupplier.java", "fileChanges": "1","committers": "1", "children": []},
                                            {"name": "FromDataPoints.java", "fileChanges": "5","committers": "2", "children": []},
                                            {"name": "Theory.java", "fileChanges": "1","committers": "1", "children": []}]},
                                        {"name": "categories", "fileChanges": "41","committers": "6", "children": [
                                            {"name": "Categories.java", "fileChanges": "6","committers": "4", "children": []},
                                            {"name": "CategoryValidator.java", "fileChanges": "6","committers": "2", "children": []},
                                            {"name": "Category.java", "fileChanges": "4","committers": "1", "children": []},
                                            {"name": "IncludeCategories.java", "fileChanges": "7","committers": "2", "children": []},
                                            {"name": "ExcludeCategories.java", "fileChanges": "7","committers": "2", "children": []},
                                            {"name": "CategoryFilterFactory.java", "fileChanges": "11","committers": "1", "children": []}]},
                                        {"name": "validator", "fileChanges": "4","committers": "1", "children": [
                                            {"name": "CategoryValidator.java", "fileChanges": "3","committers": "1", "children": []},
                                            {"name": "ValidateWith.java", "fileChanges": "1","committers": "1", "children": []}]},
                                        {"name": "runners", "fileChanges": "1","committers": "1", "children": [
                                            {"name": "Enclosed.java", "fileChanges": "1","committers": "1", "children": []}]}]},
                                    {"name": "rules", "fileChanges": "10","committers": "5", "children": [
                                        {"name": "Timeout.java", "fileChanges": "4","committers": "2", "children": []},
                                        {"name": "ExpectedException.java", "fileChanges": "4","committers": "1", "children": []},
                                        {"name": "MethodRule.java", "fileChanges": "1","committers": "1", "children": []},
                                        {"name": "Verifier.java", "fileChanges": "1","committers": "1", "children": []}]},
                                    {"name": "validator", "fileChanges": "19","committers": "1", "children": [
                                        {"name": "AnnotationValidator.java", "fileChanges": "9","committers": "1", "children": []},
                                        {"name": "AnnotationValidatorFactory.java", "fileChanges": "6","committers": "1", "children": []},
                                        {"name": "ValidateWith.java", "fileChanges": "4","committers": "1", "children": []}]},
                                    {"name": "runner", "fileChanges": "67","committers": "7", "children": [
                                        {"name": "notification", "fileChanges": "8","committers": "4", "children": [
                                            {"name": "Failure.java", "fileChanges": "2","committers": "1", "children": []},
                                            {"name": "RunNotifier.java", "fileChanges": "2","committers": "2", "children": []},
                                            {"name": "RunListener.java", "fileChanges": "3","committers": "2", "children": []},
                                            {"name": "SynchronizedRunListener.java", "fileChanges": "1","committers": "1", "children": []}]},
                                        {"name": "JUnitCore.java", "fileChanges": "12","committers": "3", "children": []},
                                        {"name": "JUnitCommandLineParseResult.java", "fileChanges": "10","committers": "1", "children": []},
                                        {"name": "FilterFactory.java", "fileChanges": "12","committers": "1", "children": []},
                                        {"name": "FilterFactories.java", "fileChanges": "10","committers": "1", "children": []},
                                        {"name": "FilterFactoryParams.java", "fileChanges": "9","committers": "1", "children": []},
                                        {"name": "Description.java", "fileChanges": "3","committers": "2", "children": []},
                                        {"name": "Result.java", "fileChanges": "1","committers": "1", "children": []},
                                        {"name": "Request.java", "fileChanges": "1","committers": "1", "children": []},
                                        {"name": "manipulation", "fileChanges": "1","committers": "1", "children": [
                                            {"name": "Sorter.java", "fileChanges": "1","committers": "1", "children": []}]}]},
                                    {"name": "Test.java", "fileChanges": "4","committers": "4", "children": []},
                                    {"name": "ComparisonFailure.java", "fileChanges": "1","committers": "1", "children": []},
                                    {"name": "After.java", "fileChanges": "1","committers": "1", "children": []},
                                    {"name": "AfterClass.java", "fileChanges": "1","committers": "1", "children": []},
                                    {"name": "Before.java", "fileChanges": "1","committers": "1", "children": []},
                                    {"name": "BeforeClass.java", "fileChanges": "1","committers": "1", "children": []},
                                    {"name": "ClassRule.java", "fileChanges": "1","committers": "1", "children": []},
                                    {"name": "Ignore.java", "fileChanges": "1","committers": "1", "children": []},
                                    {"name": "filters", "fileChanges": "2","committers": "1", "children": [
                                        {"name": "PassThroughFilter.java", "fileChanges": "2","committers": "1", "children": []}]}]}]},
                            {"name": "junit", "fileChanges": "7","committers": "4", "children": [
                                {"name": "runner", "fileChanges": "4","committers": "3", "children": [
                                    {"name": "BaseTestRunner.java", "fileChanges": "2","committers": "2", "children": []},
                                    {"name": "Version.java", "fileChanges": "1","committers": "1", "children": []},
                                    {"name": "Version.java.template", "fileChanges": "1","committers": "1", "children": []}]},
                                {"name": "textui", "fileChanges": "1","committers": "1", "children": [
                                    {"name": "TestRunner.java", "fileChanges": "1","committers": "1", "children": []}]},
                                {"name": "framework", "fileChanges": "2","committers": "2", "children": [
                                    {"name": "TestSuite.java", "fileChanges": "2","committers": "2", "children": []}]}]}]},
                        {"name": "config", "fileChanges": "6","committers": "1", "children": [
                            {"name": "settings.xml", "fileChanges": "6","committers": "1", "children": []}]},
                        {"name": "assembly", "fileChanges": "2","committers": "1", "children": [
                            {"name": "src.xml", "fileChanges": "2","committers": "1", "children": []}]}]},
                    {"name": "test", "fileChanges": "205","committers": "18", "children": [
                        {"name": "java", "fileChanges": "205","committers": "18", "children": [
                            {"name": "org", "fileChanges": "205","committers": "18", "children": [
                                {"name": "junit", "fileChanges": "205","committers": "18", "children": [
                                    {"name": "runners", "fileChanges": "6","committers": "2", "children": [
                                        {"name": "model", "fileChanges": "6","committers": "2", "children": [
                                            {"name": "FrameworkFieldTest.java", "fileChanges": "2","committers": "1", "children": []},
                                            {"name": "FrameworkMethodTest.java", "fileChanges": "2","committers": "1", "children": []},
                                            {"name": "TestClassTest.java", "fileChanges": "2","committers": "1", "children": []}]}]},
                                    {"name": "tests", "fileChanges": "156","committers": "18", "children": [
                                        {"name": "AllTests.java", "fileChanges": "18","committers": "7", "children": []},
                                        {"name": "internal", "fileChanges": "5","committers": "2", "children": [
                                            {"name": "runners", "fileChanges": "5","committers": "2", "children": [
                                                {"name": "statements", "fileChanges": "5","committers": "2", "children": [
                                                    {"name": "FailOnTimeoutTest.java", "fileChanges": "5","committers": "2", "children": []}]}]}]},
                                        {"name": "experimental", "fileChanges": "69","committers": "8", "children": [
                                            {"name": "rules", "fileChanges": "11","committers": "4", "children": [
                                                {"name": "BlockJUnit4ClassRunnerOverrideTest.java", "fileChanges": "1","committers": "1", "children": []},
                                                {"name": "MethodRulesTest.java", "fileChanges": "1","committers": "1", "children": []},
                                                {"name": "RuleFieldValidatorTest.java", "fileChanges": "2","committers": "2", "children": []},
                                                {"name": "TestRuleTest.java", "fileChanges": "1","committers": "1", "children": []},
                                                {"name": "TestWatcherTest.java", "fileChanges": "1","committers": "1", "children": []},
                                                {"name": "TimeoutRuleTest.java", "fileChanges": "2","committers": "2", "children": []},
                                                {"name": "EventCollector.java", "fileChanges": "1","committers": "1", "children": []},
                                                {"name": "ExpectedExceptionTest.java", "fileChanges": "2","committers": "1", "children": []}]},
                                            {"name": "MatcherTest.java", "fileChanges": "1","committers": "1", "children": []},
                                            {"name": "categories", "fileChanges": "4","committers": "1", "children": [
                                                {"name": "CategoryValidatorTest.java", "fileChanges": "4","committers": "1", "children": []}]},
                                            {"name": "validation", "fileChanges": "1","committers": "1", "children": [
                                                {"name": "CategoryValidatorTest.java", "fileChanges": "1","committers": "1", "children": []}]},
                                            {"name": "theories", "fileChanges": "49","committers": "3", "children": [
                                                {"name": "internal", "fileChanges": "9","committers": "2", "children": [
                                                    {"name": "AllMembersSupplierTest.java", "fileChanges": "6","committers": "2", "children": []},
                                                    {"name": "SpecificDataPointsSupplierTest.java", "fileChanges": "2","committers": "1", "children": []},
                                                    {"name": "ParameterizedAssertionErrorTest.java", "fileChanges": "1","committers": "1", "children": []}]},
                                                {"name": "runner", "fileChanges": "19","committers": "1", "children": [
                                                    {"name": "WithAutoGeneratedDataPoints.java", "fileChanges": "1","committers": "1", "children": []},
                                                    {"name": "FailingDataPointMethods.java", "fileChanges": "1","committers": "1", "children": []},
                                                    {"name": "WithDataPointMethod.java", "fileChanges": "7","committers": "1", "children": []},
                                                    {"name": "WithExtendedParameterSources.java", "fileChanges": "1","committers": "1", "children": []},
                                                    {"name": "WithNamedDataPoints.java", "fileChanges": "2","committers": "1", "children": []},
                                                    {"name": "WithParameterSupplier.java", "fileChanges": "3","committers": "1", "children": []},
                                                    {"name": "UnsuccessfulWithDataPointFields.java", "fileChanges": "4","committers": "1", "children": []}]},
                                                {"name": "AssumingInTheoriesTest.java", "fileChanges": "4","committers": "2", "children": []},
                                                {"name": "extendingwithstubs", "fileChanges": "3","committers": "1", "children": [
                                                    {"name": "StubbedTheories.java", "fileChanges": "3","committers": "1", "children": []}]},
                                                {"name": "TheoryTestUtils.java", "fileChanges": "3","committers": "1", "children": []},
                                                {"name": "ParameterSignatureTest.java", "fileChanges": "2","committers": "1", "children": []},
                                                {"name": "PotentialAssignmentTest.java", "fileChanges": "2","committers": "1", "children": []},
                                                {"name": "TheoryFailureMessagesTest.java", "fileChanges": "3","committers": "1", "children": []},
                                                {"name": "TestedOnSupplierTest.java", "fileChanges": "2","committers": "1", "children": []},
                                                {"name": "EnumDatapointNamesTest.java", "fileChanges": "2","committers": "1", "children": []}]},
                                            {"name": "ExperimentalTests.java", "fileChanges": "3","committers": "1", "children": []}]},
                                        {"name": "running", "fileChanges": "25","committers": "6", "children": [
                                            {"name": "classes", "fileChanges": "20","committers": "5", "children": [
                                                {"name": "ParentRunnerTest.java", "fileChanges": "9","committers": "2", "children": []},
                                                {"name": "TestClassTest.java", "fileChanges": "6","committers": "3", "children": []},
                                                {"name": "ClassLevelMethodsWithIgnoredTestsTest.java", "fileChanges": "4","committers": "1", "children": []},
                                                {"name": "ParameterizedTestTest.java", "fileChanges": "1","committers": "1", "children": []}]},
                                            {"name": "methods", "fileChanges": "5","committers": "1", "children": [
                                                {"name": "TimeoutTest.java", "fileChanges": "5","committers": "1", "children": []}]}]},
                                        {"name": "validation", "fileChanges": "23","committers": "1", "children": [
                                            {"name": "classes", "fileChanges": "19","committers": "1", "children": [
                                                {"name": "BeforeClassAndTestFailButClassIsIgnored.java", "fileChanges": "3","committers": "1", "children": []},
                                                {"name": "HasAfterClassButTestIsIgnored.java", "fileChanges": "3","committers": "1", "children": []},
                                                {"name": "HasBeforeClassButTestIsFiltered.java", "fileChanges": "3","committers": "1", "children": []},
                                                {"name": "HasBeforeClassButTestIsIgnored.java", "fileChanges": "3","committers": "1", "children": []},
                                                {"name": "HasBrokenRuleButTestIsIgnored.java", "fileChanges": "3","committers": "1", "children": []},
                                                {"name": "HasUnfilteredTest.java", "fileChanges": "2","committers": "1", "children": []},
                                                {"name": "HasBeforeClassButNoTests.java", "fileChanges": "2","committers": "1", "children": []}]},
                                            {"name": "ClassLevelMethodsOnlyRunWhenNecessaryTest.java", "fileChanges": "4","committers": "1", "children": []}]},
                                        {"name": "junit3compatibility", "fileChanges": "8","committers": "1", "children": [
                                            {"name": "JUnit38ClassRunnerTest.java", "fileChanges": "8","committers": "1", "children": []}]},
                                        {"name": "assertion", "fileChanges": "8","committers": "4", "children": [
                                            {"name": "MultipleFailureExceptionTest.java", "fileChanges": "3","committers": "1", "children": []},
                                            {"name": "ComparisonFailureTest.java", "fileChanges": "3","committers": "1", "children": []},
                                            {"name": "AssertionTest.java", "fileChanges": "2","committers": "2", "children": []}]}]},
                                    {"name": "experimental", "fileChanges": "6","committers": "2", "children": [
                                        {"name": "categories", "fileChanges": "6","committers": "2", "children": [
                                            {"name": "CategoryFilterFactoryTest.java", "fileChanges": "6","committers": "2", "children": []}]}]},
                                    {"name": "runner", "fileChanges": "31","committers": "3", "children": [
                                        {"name": "notification", "fileChanges": "4","committers": "2", "children": [
                                            {"name": "SynchronizedRunListenerTest.java", "fileChanges": "2","committers": "2", "children": []},
                                            {"name": "ConcurrentRunNotifierTest.java", "fileChanges": "1","committers": "1", "children": []},
                                            {"name": "RunNotifierTest.java", "fileChanges": "1","committers": "1", "children": []}]},
                                        {"name": "FilterFactoriesTest.java", "fileChanges": "10","committers": "1", "children": []},
                                        {"name": "JUnitCommandLineParseResultTest.java", "fileChanges": "10","committers": "1", "children": []},
                                        {"name": "JUnitCoreTest.java", "fileChanges": "2","committers": "1", "children": []},
                                        {"name": "FilterFactoryParamsTest.java", "fileChanges": "2","committers": "1", "children": []},
                                        {"name": "FilterOptionIntegrationTest.java", "fileChanges": "3","committers": "1", "children": []}]},
                                    {"name": "validator", "fileChanges": "6","committers": "1", "children": [
                                        {"name": "AnnotationValidatorFactoryTest.java", "fileChanges": "6","committers": "1", "children": []}]}]}]}]}]},
                    {"name": "site", "fileChanges": "15","committers": "1", "children": [
                        {"name": "resources", "fileChanges": "10","committers": "1", "children": [
                            {"name": "scripts", "fileChanges": "5","committers": "1", "children": [
                                {"name": "intro.min.js", "fileChanges": "2","committers": "1", "children": []},
                                {"name": "hopscotch-0.1.2.min.js", "fileChanges": "1","committers": "1", "children": []},
                                {"name": "index.js", "fileChanges": "2","committers": "1", "children": []}]},
                            {"name": "css", "fileChanges": "3","committers": "1", "children": [
                                {"name": "introjs.min.css", "fileChanges": "2","committers": "1", "children": []},
                                {"name": "hopscotch-0.1.2.min.css", "fileChanges": "1","committers": "1", "children": []}]},
                            {"name": "images", "fileChanges": "2","committers": "1", "children": [
                                {"name": "junit-logo.png", "fileChanges": "1","committers": "1", "children": []},
                                {"name": "junit-logo.svg", "fileChanges": "1","committers": "1", "children": []}]}]},
                        {"name": "xdoc", "fileChanges": "2","committers": "1", "children": [
                            {"name": "index.xml", "fileChanges": "2","committers": "1", "children": []}]},
                        {"name": "markdown", "fileChanges": "1","committers": "1", "children": [
                            {"name": "cookbook.md", "fileChanges": "1","committers": "1", "children": []}]},
                        {"name": "fml", "fileChanges": "1","committers": "1", "children": [
                            {"name": "faq.fml", "fileChanges": "1","committers": "1", "children": []}]},
                        {"name": "site.xml", "fileChanges": "1","committers": "1", "children": []}]},
                    {"name": "changes", "fileChanges": "1","committers": "1", "children": [
                        {"name": "changes.xml", "fileChanges": "1","committers": "1", "children": []}]}]},
                {"name": "pom.xml", "fileChanges": "25","committers": "4", "children": []},
                {"name": ".travis.yml", "fileChanges": "1","committers": "1", "children": []},
                {"name": "CONTRIBUTING.md", "fileChanges": "2","committers": "2", "children": []},
                {"name": ".gitignore", "fileChanges": "4","committers": "1", "children": []},
                {"name": ".settings", "fileChanges": "10","committers": "2", "children": [
                    {"name": "org.eclipse.jdt.core.prefs", "fileChanges": "6","committers": "2", "children": []},
                    {"name": "org.eclipse.jdt.ui.prefs", "fileChanges": "4","committers": "1", "children": []}]},
                {"name": "doc", "fileChanges": "15","committers": "5", "children": [
                    {"name": "ReleaseNotes4.5.html", "fileChanges": "1","committers": "1", "children": []},
                    {"name": "faq", "fileChanges": "1","committers": "1", "children": [
                        {"name": "faq.htm", "fileChanges": "1","committers": "1", "children": []}]},
                    {"name": "homepage.html", "fileChanges": "2","committers": "2", "children": []},
                    {"name": "ReleaseNotes4.10.html", "fileChanges": "1","committers": "1", "children": []},
                    {"name": "ReleaseNotes4.10.md", "fileChanges": "1","committers": "1", "children": []},
                    {"name": "ReleaseNotes4.12.md", "fileChanges": "1","committers": "1", "children": []},
                    {"name": "building-junit.txt", "fileChanges": "8","committers": "3", "children": []}]},
                {"name": ".cvsignore", "fileChanges": "1","committers": "1", "children": []},
                {"name": "build", "fileChanges": "6","committers": "3", "children": [
                    {"name": ".cvsignore", "fileChanges": "1","committers": "1", "children": []},
                    {"name": "maven", "fileChanges": "4","committers": "2", "children": [
                        {"name": "junit-dep-pom-template.xml", "fileChanges": "2","committers": "2", "children": []},
                        {"name": "junit-pom-template.xml", "fileChanges": "2","committers": "2", "children": []}]},
                    {"name": "github_upload.rb", "fileChanges": "1","committers": "1", "children": []}]},
                {"name": "build.xml", "fileChanges": "3","committers": "3", "children": []},
                {"name": "cpl-v10.html", "fileChanges": "1","committers": "1", "children": []},
                {"name": "LICENSE.txt", "fileChanges": "2","committers": "2", "children": []},
                {"name": "epl-v10.html", "fileChanges": "1","committers": "1", "children": []},
                {"name": "BUILDING", "fileChanges": "2","committers": "2", "children": []},
                {"name": "README.md", "fileChanges": "6","committers": "2", "children": []},
                {"name": "acknowledgements.txt", "fileChanges": "1","committers": "1", "children": []},
                {"name": "NOTICE.txt", "fileChanges": "3","committers": "1", "children": []},
                {"name": "stylesheet.css", "fileChanges": "1","committers": "1", "children": []},
                {"name": "Makefile", "fileChanges": "1","committers": "1", "children": []}]
            }
            ;

    newEnv(container, window, createCodeCity).animate();

    function createCodeCity(env) {
        var xSize = 1800;
        var ySize = 1800;
        var zSize = 900;
        var pad = 20;
        var cityCenter = new THREE.Vector3(xSize / 2, ySize / 2, 0);
        var xyValue = _.property("fileChanges");
        var zValue = _.property("committers");

        var color = d3.scale.category20();
        var treemap = d3.layout.treemap()
                .size([xSize, ySize])
                .padding(pad)
                .round(true)
                .value(xyValue);
        treemap.nodes(rootNode);
        var zScale = d3.scale.linear()
                       .domain([0, maxValueInTree(rootNode, zValue)])
                       .range([0, zSize]);
        treemapZNodes(rootNode, zScale, zValue, pad / 2);

        function createNodeObjects(node) {
            var geometry = new THREE.BoxGeometry(node.dx, node.dy, node.dz, 5, 5, 5);
            if (node.children === undefined) {
                var modifier = new THREE.SubdivisionModifier(1);
                modifier.modify(geometry);
            }
            var object = new THREE.Mesh(geometry, new THREE.MeshLambertMaterial({color: color(node.name)}));
            object.position.set(
                node.x + (node.dx / 2),
                node.y + (node.dy / 2),
                node.z + (node.dz / 2)
            );
            object.node = node;
            env.scene.add(object);

            if (node.children !== undefined) {
                node.children.forEach(function(child) {
                    createNodeObjects(child);
                })
            }
        };
        createNodeObjects(rootNode);

//        showXYZPlanesOn(env.scene);

        function addLight(x, y, z) {
            var light = new THREE.DirectionalLight(0xffffff, 1);
            light.position.set(x, y, z);
            light.lookAt(cityCenter);
            env.scene.add(light);
        }
        addLight(1, 1, 1);
        addLight(-1, -1, 1);

        var positionOnSphere = newPositionOnSphere(env.camera.position)
                .center(cityCenter.x, cityCenter.y, cityCenter.z)
                .bounds(undefined, [0.1, 1.5], [1000, 4000])
                .set(0.9, 1.1, 2000);
        env.window.addEventListener("keypress", xyzKeyController(positionOnSphere, [0.1, -0.1, 50], function () {
            env.camera.lookAt(cityCenter);
        }));
//        env.window.addEventListener("mousemove", xyzMouseController(positionOnSphere, env, {x: 0.8, y: 0.8}, function () {
//            env.camera.lookAt(new THREE.Vector3(xSize/2, ySize/2, 0));
//        }));
    }

    function newEnv(container, window, onInit) {
        var mouse = new THREE.Vector2();
        var rayCastedObjects = null;
        var renderListeners = [];

        var scene = new THREE.Scene();
        scene.position.set(0, 0, 0);

        var camera = new THREE.PerspectiveCamera(70, window.innerWidth / window.innerHeight, 1, 10000);
        camera.up.set(0, 0, 1);

        var raycaster = new THREE.Raycaster();

        var renderer = new THREE.WebGLRenderer();
        renderer.setClearColor(0xf0f0f0);
        renderer.setPixelRatio(window.devicePixelRatio);
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.sortObjects = false;
        container.appendChild(renderer.domElement);

        var stats = new Stats();
        stats.domElement.style.position = 'absolute';
        stats.domElement.style.top = '0px';
        container.appendChild(stats.domElement);

        window.addEventListener('mousemove', function () {
            event.preventDefault();
            mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;
        });
        window.addEventListener('resize', function () {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

        function render() {
            camera.updateMatrixWorld();

            raycaster.setFromCamera(mouse, camera);
            var intersects = raycaster.intersectObjects(scene.children);
            var newRayCasted = intersects.length > 0 ? intersects[0].object : null;

            if (newRayCasted !== null) {
                if (rayCastedObjects !== newRayCasted && newRayCasted.material.emissive !== undefined) {
                    if (rayCastedObjects !== null) rayCastedObjects.material.emissive.setHex(rayCastedObjects.currentHex);
                    rayCastedObjects = newRayCasted;
                    rayCastedObjects.currentHex = rayCastedObjects.material.emissive.getHex();
                    rayCastedObjects.material.emissive.setHex(0x111111);
//                console.log(rayCastedObjects.node.name); TODO
                }
            } else {
                if (rayCastedObjects !== null) rayCastedObjects.material.emissive.setHex(rayCastedObjects.currentHex);
                rayCastedObjects = null;
            }

            renderer.render(scene, camera);
            renderListeners.forEach(function(it) { it(); });

            stats.update();
        }

        function animate() {
            requestAnimationFrame(animate);
            render();
        }

        var it = {
            scene: scene,
            camera: camera,
            window: window,
            raycastedObjects: function() {
                return rayCastedObjects;
            },
            addRenderListener: function (listener) {
                renderListeners.push(listener);
            },
            animate: animate
        };
        if (onInit !== undefined) {
            onInit(it);
        }

        return it;
    }

    function treemapZNodes(node, scale, valueGetter, zShift, parentZ) {
        parentZ = parentZ || 0;
        node.z = parentZ + zShift + scale(scale.range()[0]);
        if (node.children !== undefined) {
            _.forEach(node.children, function (child) {
                return treemapZNodes(child, scale, valueGetter, zShift, node.z);
            });
            node.dz = zShift;
        } else {
            node.dz = node.z + scale(valueGetter(node));
        }
        return node;
    }

    function maxValueInTree(node, valueGetter) {
        var maxChildValue = Number.NEGATIVE_INFINITY;
        if (node.children !== undefined) {
            maxChildValue = +valueGetter(_.max(node.children, function(childNode) {
                return maxValueInTree(childNode, valueGetter);
            }));
        }
        return Math.max(+valueGetter(node), maxChildValue);
    }

</script>
</body>
</html>
